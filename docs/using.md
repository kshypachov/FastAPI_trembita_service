# Використання сервісу

### **Person Post**
Створюється один запис з БД про певну особу.

| Метод HTTP | Код сервісу   | Базова URL                        |
|:----------:|:-------------:|-----------------------------------|
|     POST   | Person Post   | http://your-server-ip:8000/person |


Параметри запиту виглядають наступним чином:

```
{
      "name": "Марина",
      "surname": "Петренко",
      "patronym": "Петрівна",
      "dateOfBirth": "2024-10-11",
      "gender": "female",
      "rnokpp": "1111111111",
      "passportNumber": "123456789",
      "unzr": "20241011-12345"
    }
```
де:

| Рівень <br/> вкладеності | Назва <br/>параметру   | Тип даних                          | Значення параметру                                                                                                                            | Обов’язковість |
|:------------------------:|------------------------|------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|:--------------:|
|            1             | 	name                | 	String, <br/>min=1, <br/>max=128 | 	Ім’я                                                                                                                                     |     	Так       |
|            1             | 	surname             | 	String, <br/>min=1, <br/>max=128 | 	Прізвище                                                                                                                                 |      Так       |
|            1             | 	patronym            | 	String, <br/>min=0,<br/> max=128 | 	По батькові                                                                                                                              |      Ні        |
|            1             | 	dateOfBirth         | 	String                           | 	Дата народження                                                                                                                          |      Так       |
|            1             | 	gender              | 	String                           | 	Стать                                                                                                                                    |      Так       |
|            1             | 	rnokpp              | 	String                           | 	РНОКПП, 10 цифр                                                                                                                          |      Так       |
|            1             | 	passportNumber      | 	String                           | 	Номер паспорта.<br/> **Для старого формату** – перші 2 символи - літери від А до Я, пробіл, 6 цифр.<br/> **Для нового формату** – 9 цифр |      Так       |
|            1             | 	unzr                | 	String                           | 	УНЗР, 14 символів в форматі YYYYMMDD-XXXXC, де  YYYY – рік, MM – місяць, DD – день,  XXXXC – 5 цифр                                      |      Так       |

**Приклад запиту** за допомогою утиліти **curl** виглядає наступним чином:

```
curl -X 'POST' \
  'http://your-server-ip:8000/person' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d "{\"name\": \"Марина\", \"surname\": \"Петренко\", \"patronym\": \"Петрівна\", \"dateOfBirth\": \"2024-10-11\", \"gender\": \"female\", \"rnokpp\": \"1111111111\", \"passportNumber\": \"123456789\", \"unzr\": \"20241011-12345\"}"
```

**Тіло відповіді** у разі успішного опрацювання запиту (**HTTP Code=200**) виглядатиме наступним чином:

```
{
  "message": {
    "id": 2
  }
}
```

де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру        | Обов’язковість |
|:------------------------:|----------------------|-----------|---------------------------|:--------------:|
|            1             | 	message             | 	Array    | 	Масив даних              |      	Так      |
|            2             | id                   | Integer   | Ідентифікатор користувача |      Так       |

**Тіло відповіді** у разі не успішного опрацювання запиту (**HTTP Code=422** - Validation error) виглядатиме наступним чином:

```
{
  "detail": [
    {
      "type": "value_error",
      "loc": [
        "body",
        "rnokpp"
      ],
      "msg": "Value error, RNOKPP must be a 10 digit number",
      "input": "11111111312",
      "ctx": {
        "error": {}
      }
    }
  ]
}
```

де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру                                                                 | Обов’язковість |
|:------------------------:|----------------------|-----------|------------------------------------------------------------------------------------|:--------------:|
|            1             | detail               | Array     | Масив даних                                                                        |      Так       |
|            2             | type                 | String    | Тип помилки                                                                        |      Так       |
|            2             | loc                  | Array     | Масив даних щодо розташування помилки                                              |      Так       |
|            2             | msg                  | String    | Опис помилки                                                                       |      Так       |
|            2             | input                | String    | Проблемне значення                                                                 |      Так       |
|            2             | ctx                  | Object    | Додатковий контекст помилки, який може містити специфічну інформацію щодо проблеми |       Ні       |
|            3             | error                | Object    | Опис помилки                                                                       |       Ні       |

**Тіло відповіді** у разі не успішного опрацювання запиту (**HTTP Code=400**) виглядатиме наступним чином:

```
{
  "detail":"Data integrity error"
}
```
де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру | Обов’язковість |
|:------------------------:|----------------------|-----------|--------------------|:--------------:|
|            1             | 	detail            |  String   |  Опис помилки      |    Так         |


### **Person Get All**

Повертає всі записи з БД.

| Метод HTTP |  Код сервісу   | Базова URL                        |
|:----------:|:--------------:|-----------------------------------|
|    GET     | Person Get All | http://your-server-ip:8000/person |

**Параметри запиту**, що передаються в URL виглядають наступним чином:

```
	"queryId":"?",
	"userId":"?"
```

де:

|  **Назва параметру**  |  **Тип даних**  |   **Значення параметру**   |  **Обов’язковість**  |
|:---------------------:|:---------------:|:--------------------------:|:--------------------:|
|        queryId        |     	String     |   	Ідентифікатор запиту    |         	Ні          |
|        userId         |     String      | 	Ідентифікатор користувача |         	Ні          |

**Приклад запиту** за допомогою утиліти **curl** виглядає наступним чином:

```
curl -X 'GET' \
  'http://your-server-ip:8000/person?queryId=jsdjd532khshs&userId=MyGreatApplication' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json'
  ```

або:

```
curl -X 'GET' \
  'http://your-server-ip:8000/person' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json'
```

**Тіло відповіді** у разі успішного опрацювання запиту (**HTTP Code=200**) виглядатиме наступним чином:

```
{
  "message": [
    {
      "id": 1,
      "name": "Марина",
      "surname": "Петренко",
      "patronym": "Петрівна",
      "dateOfBirth": "2024-10-44",
      "gender": "female",
      "rnokpp": "1111111111",
      "passportNumber": "123456789",
      "unzr": "20241011-12345"
    },
    {
      "id": 2,
      "name": "Карен",
      "surname": "Симоненко",
      "patronym": "Олегович",
      "dateOfBirth": "2017-12-22",
      "gender": "male",
      "rnokpp": "1111111131",
      "passportNumber": "133456789",
      "unzr": "201712022-12445"
    }
  ]
}
```

де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних                         | Значення параметру                                                                                                                        | Обов’язковість |
|:------------------------:|----------------------|-----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|:--------------:|
|            1             | 	message             | 	Array                            | 	Масив даних                                                                                                                              |      	Так      |
|            2             |                      | JSON Object                       | Структура для даних про користувача                                                                                                       |      Так       |
|            3             | 	id	                 | Integer                           | 	Ідентифікатор користувача                                                                                                                |      	Так      |
|            3             | 	name                | 	String, <br/>min=1, <br/>max=128 | 	Ім’я                                                                                                                                     |      	Так      |
|            3             | 	surname             | 	String, <br/>min=1, <br/>max=128 | 	Прізвище                                                                                                                                 |      	Так      |
|            3             | 	patronym            | 	String, <br/>min=0,<br/> max=128 | 	По батькові                                                                                                                              |      	Ні       |
|            3             | 	dateOfBirth         | 	String                           | 	Дата народження                                                                                                                          |      	Так      |
|            3             | 	gender              | 	String                           | 	Стать                                                                                                                                    |      	Так      |
|            3             | 	rnokpp              | 	String                           | 	РНОКПП, 10 цифр                                                                                                                          |      	Так      |
|            3             | 	passportNumber      | 	String                           | 	Номер паспорта.<br/> **Для старого формату** – перші 2 символи - літери від А до Я, пробіл, 6 цифр.<br/> **Для нового формату** – 9 цифр |      	Так      |
|            3             | 	unzr                | 	String                           | 	УНЗР, 14 символів в форматі YYYYMMDD-XXXXC, де  YYYY – рік, MM – місяць, DD – день,  XXXXC – 5 цифр                                      |      Так       |

Тіло відповіді у разі не успішного опрацювання запиту (**HTTP Code=404**) виглядатиме наступним чином:

```
{
 "detail":"Person not found"
}
```

де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру | Обов’язковість |
|:------------------------:|----------------------|-----------|--------------------|:--------------:|
|            1             | 	detail              | 	String   | 	Опис помилки      |      	Так      |


### **Person Update**
Вносить зміни для певного запису з БД про певну особу.

| Метод HTTP |  Код сервісу  | Базова URL                        |
|:----------:|:-------------:|-----------------------------------|
|    PUT     | Person Update | http://your-server-ip:8000/person |


Параметри запиту виглядають наступним чином:

```
{
      "name": "Марина",
      "surname": "Петренко",
      "patronym": "Олегівна",
      "dateOfBirth": "2024-10-44",
      "gender": "female",
      "rnokpp": "1111111111",
      "passportNumber": "123456789",
      "unzr": "20241011-12345"
    }
```

де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних                         | Значення параметру                                                                                                                        | Обов’язковість |
|:------------------------:|----------------------|-----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|:--------------:|
|            1             | 	name                | 	String, <br/>min=1, <br/>max=128 | 	Ім’я                                                                                                                                     |      	Так      |
|            1             | 	surname             | 	String, <br/>min=1, <br/>max=128 | 	Прізвище                                                                                                                                 |      	Так      |
|            1             | 	patronym            | 	String, <br/>min=0,<br/> max=128 | 	По батькові                                                                                                                              |      	Ні       |
|            1             | 	dateOfBirth         | 	String                           | 	Дата народження                                                                                                                          |      	Так      |
|            1             | 	gender              | 	String                           | 	Стать                                                                                                                                    |      	Так      |
|            1             | 	rnokpp              | 	String                           | 	РНОКПП, 10 цифр                                                                                                                          |      	Так      |
|            1             | 	passportNumber      | 	String                           | 	Номер паспорта.<br/> **Для старого формату** – перші 2 символи - літери від А до Я, пробіл, 6 цифр.<br/> **Для нового формату** – 9 цифр |      	Так      |
|            1             | 	unzr                | 	String                           | 	УНЗР, 14 символів в форматі YYYYMMDD-XXXXC, де  YYYY – рік, MM – місяць, DD – день,  XXXXC – 5 цифр                                      |      Так       |

**Важливо!** Обмеження сервісу – не можна міняти поле **unzr**!

**Приклад запиту** за допомогою утиліти **curl** виглядає наступним чином:

```
curl -X 'PUT' \
  'http://your-server-ip:8000/person' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d "{\"name\": \"Марина\", \"surname\": \"Петренко\", \"patronym\": \"Петрівна\", \"dateOfBirth\": \"2024-10-11\", \"gender\": \"female\", \"rnokpp\": \"1111111111\", \"passportNumber\": \"123456789\", \"unzr\": \"20241011-12345\"}"
```

**Тіло відповіді** у разі успішного опрацювання запиту (**HTTP Code=200**) виглядатиме наступним чином:

```
{  
"message": "Person updated successfully"
}
```

де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру                   | Обов’язковість |
|:------------------------:|----------------------|-----------|--------------------------------------|:--------------:|
|            1             | 	message             | 	String   | 	Повідомлення про опрацювання запиту |      Так       |

В разі, якщо передані дані співпадають з тими, що вже є в БД, зміни внесено не буде, а в результаті виконання запиту буде передано **HTTP Code=204**.

**Тіло відповіді** у разі не успішного опрацювання запиту (**HTTP Code=422 - Validation error**) виглядатиме наступним чином:

```
{
  "detail": [
    {
      "type": "date_from_datetime_parsing",
      "loc": [
        "body",
        "dateOfBirth"
      ],
      "msg": "Input should be a valid date or datetime, invalid datetime separator, expected `T`, `t`, `_` or space",
      "input": "2024-10-223",
      "ctx": {
        "error": "invalid datetime separator, expected `T`, `t`, `_` or space"
      }
    }
  ]
}
```

де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру                                                                 | Обов’язковість |
|:------------------------:|----------------------|-----------|------------------------------------------------------------------------------------|:--------------:|
|            1             | 	detail            | Array     | Масив даних                                                                        |      Так       |
|            2             | type                 | String    | Тип помилки                                                                        |      Так       |
|            2             | loc                  | Array     | Масив даних щодо розташування помилки                                              |      Так       |
|            2             | msg                  | String    | Опис помилки                                                                       |      Так       |
|            2             | input                | String    | Проблемне значення                                                                 |      Так       |
|            2             | ctx                  | Object    | Додатковий контекст помилки, який може містити специфічну інформацію щодо проблеми |       Ні       |
|            3             | error                | Object    | Опис помилки                                                                       |       Ні       |

**Тіло відповіді** у разі відсутності користувача з заданим unzr (**HTTP Code=404**) виглядатиме наступним чином:

```
{
"detail":"Person not found"
}
```

де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру | Обов’язковість |
|:------------------------:|----------------------|-----------|--------------------|:--------------:|
|            1             | 	detail              | 	String   | 	Опис помилки      |      	Так      |


### **Person Get By Parameter**

Повертає записи з БД відповідно до заданих параметрів.

| Метод HTTP |       Код сервісу       | Базова URL                        |
|:----------:|:-----------------------:|-----------------------------------|
|    GET     | Person Get By Parameter | http://your-server-ip:8000/person |

**Параметри запиту**, що передаються в URL виглядають наступним чином:
```
	"param":"?",
	"value":"?"
```

де:

| **Назва параметру** | **Тип даних** | **Значення параметру**                                                                                                                                                                                                        | **Обов’язковість** |
|:-------------------:|:-------------:|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:------------------:|
|        param        |    String     | Вказується конкретний параметр, що стосується певного запису в БД, наприклад, ім’я, УНЗР тощо. <br/> Назва параметру має бути однією з наступних:  name, surname, patronym, dateOfBirth, gender, rnokpp, passportNumber, unzr |        	Так        |                                                                      
|        value        |    String     | 	Значення вказаного параметру                                                                                                                                                                                          |        	Так        |

**Приклад запиту** за допомогою утиліти **curl** виглядає наступним чином:
```
curl -X 'GET' \
  'http://1http://your-server-ip:8000/person/gender/female ' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json'
  ```

**Тіло відповіді** у разі успішного опрацювання запиту (**HTTP Code=200**) виглядатиме наступним чином:

```
{
  "message": [
    {
      "id": 1,
      "name": "Марина",
      "surname": "Петренко",
      "patronym": "Петрівна",
      "dateOfBirth": "2078-10-28",
      "gender": "female",
      "rnokpp": "1111111111",
      "passportNumber": "123456789",
      "unzr": "20241011-12345"
    },
    {
      "id": 2,
      "name": "Карен",
      "surname": "Симоненко",
      "patronym": "Олегович",
      "dateOfBirth": "2067-12-22",
      "gender": "male",
      "rnokpp": "1111111131",
      "passportNumber": "133456789",
      "unzr": "20241011-12445"
    }
  ]
}
```

де:

|  Рівень <br/> вкладеності  | Назва <br/>параметру | Тип даних                         | Значення параметру                                                                                                                        | Обов’язковість |
|:--------------------------:|----------------------|-----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|:--------------:|
|             1              | 	message             | 	Array                            | 	Масив даних                                                                                                                              |      	Так      |
|             2              | 	id	                 | Integer                           | 	Ідентифікатор користувача                                                                                                                |      	Так      |
|             2              | 	name                | 	String, <br/>min=1, <br/>max=128 | 	Ім’я                                                                                                                                     |      	Так      |
|             2              | 	surname             | 	String, <br/>min=1, <br/>max=128 | 	Прізвище                                                                                                                                 |      	Так      |
|             2              | 	patronym            | 	String, <br/>min=0,<br/> max=128 | 	По батькові                                                                                                                              |      	Ні       |
|             2              | 	dateOfBirth         | 	String                           | 	Дата народження                                                                                                                          |      	Так      |
|             2              | 	gender              | 	String                           | 	Стать                                                                                                                                    |      	Так      |
|             2              | 	rnokpp              | 	String                           | 	РНОКПП, 10 цифр                                                                                                                          |      	Так      |
|             2              | 	passportNumber      | 	String                           | 	Номер паспорта.<br/> **Для старого формату** – перші 2 символи - літери від А до Я, пробіл, 6 цифр.<br/> **Для нового формату** – 9 цифр |      	Так      |
|             2              | 	unzr                | 	String                           | 	УНЗР, 14 символів в форматі YYYYMMDD-XXXXC, де  YYYY – рік, MM – місяць, DD – день,  XXXXC – 5 цифр                                      |      Так       |


**Тіло відповіді** у разі не успішного опрацювання запиту (**HTTP Code=404**) виглядатиме наступним чином:
```
{
"detail":"Person not found"
}
```
де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру | Обов’язковість |
|:------------------------:|----------------------|-----------|--------------------|:--------------:|
|            1             | 	detail              | 	String   | 	Опис помилки      |      	Так      |

**Тіло відповіді** у разі не успішного опрацювання запиту (**HTTP Code=422 - Validation error**) виглядатиме наступним чином:
```
{
"detail": "Parameter 'name3' is not a valid field"
}
```
або:
```
{
"detail": "Validation error for parameter 'gender' with value 'erfsdfasdf': 1 validation error for PersonGet\ngender\n  Value error, Gender must be either \"male\" or \"female\" [type=value_error, input_value='erfsdfasdf', input_type=str]\n    For further information visit https://errors.pydantic.dev/2.7/v/value_error"
}
```
де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру | Обов’язковість |
|:------------------------:|----------------------|-----------|--------------------|:--------------:|
|            1             | 	detail              | 	String   | 	Опис помилки      |      	Так      |


### **Person Delete**
Дозволяє видалити запис з БД тільки за УНЗР.

| Метод HTTP |       Код сервісу       | Базова URL                        |
|:----------:|:-----------------------:|-----------------------------------|
|   DELETE   | Person Get By Parameter | http://your-server-ip:8000/person |

**Параметри запиту**, що передаються в URL виглядають наступним чином:

```
	"param":"?",
	"value":"?"
```

де:

| **Назва параметру** | **Тип даних** |      **Значення параметру**      | **Обов’язковість** |
|:-------------------:|:-------------:|:--------------------------------:|:------------------:|
|        param        |    String     |  Значення за замовченням – unzr  |        Так         |
|        value        |    String     |  УНЗР запису який треба видалити |        Так         |

**Приклад запиту** за допомогою утиліти **curl** виглядає наступним чином:
```
curl -X 'DELETE' 'http://your-server-ip:8000/person/unzr/20241011-12345'
```

**Тіло відповіді** у разі успішного опрацювання запиту (**HTTP Code=200**) виглядатиме наступним чином:
```
{  
"message": "Person deleted successfully"
}
```
де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру                   | Обов’язковість |
|:------------------------:|----------------------|-----------|--------------------------------------|:--------------:|
|            1             | 	message           |  String   | Повідомлення про опрацювання запиту  |      Так       |

**Тіло відповіді** у разі відсутності запису в БД із заданим УНЗР (**HTTP Code=404**) виглядатиме наступним чином:
```
{
"detail":"Person not found"
}
```
де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру | Обов’язковість |
|:------------------------:|----------------------|-----------|--------------------|:--------------:|
|            1             | 	detail            |  String   |  Опис помилки      |      Так       |

**Тіло відповіді** у разі не успішного опрацювання запиту (**HTTP Code=422**) виглядатиме наступним чином:
```
{
"detail": "Validation error for parameter 'unzr' with value '20241011-12445werewr': 1 validation error for PersonDelete\nunzr\n  Value error, UNZR must be in the format YYYYMMDD-XXXXC [type=value_error, input_value='20241011-12445werewr', input_type=str]\n    For further information visit https://errors.pydantic.dev/2.7/v/value_error"
}
```
або:
```
{
"detail": "Parameter 'unzrdgh' is not a valid field"
}
```
де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру | Обов’язковість |
|:------------------------:|----------------------|-----------|--------------------|:--------------:|
|            1             | 	detail            |  String   |  Опис помилки      |      Так       |

 ##
Матеріали створено за підтримки проєкту міжнародної технічної допомоги «Підтримка ЄС цифрової трансформації України (DT4UA)».
